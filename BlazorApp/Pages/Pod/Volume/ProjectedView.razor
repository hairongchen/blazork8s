@using k8s.Models
@using BlazorApp.Pages.Common.Html.HTable
@using BlazorApp.Pages.Common.Metadata
@if (Volume.Projected != null)
{
    <HTable >

        <HTr>
            <HTd ColSpan="2">
                <Badge Count="@Index"></Badge>
                @Volume.Name
                <Tag PresetColor="PresetColor.Lime">Projected</Tag>
            </HTd>
        </HTr>
        <PropertySimpleView Title="DefaultMode" ExplainField="pod.spec.volumes.projected.defaultMode" Item="@Volume.Projected.DefaultMode"></PropertySimpleView>

        @foreach (var p in Volume.Projected.Sources)
        {
            @if (p.DownwardAPI != null)
            {
                @foreach (var item in p.DownwardAPI.Items)
                {
                    <HTr>
                        <HTd >
                            DownwardAPI
                            <KubectlExplainButton Field="pod.spec.volumes.downwardAPI"></KubectlExplainButton>
                        </HTd >
                        <HTd >
                            <Tag Icon="hdd" PresetColor="@PresetColor.Green">@item.Path</Tag>
                            @if (item.FieldRef != null)
                            {
                                <Tag>@item.Mode @item.FieldRef.ApiVersion @item.FieldRef.FieldPath </Tag>
                            }
                            @if (item.ResourceFieldRef != null)
                            {
                                <Tag> @item.ResourceFieldRef.ContainerName/@item.ResourceFieldRef.Resource @item.ResourceFieldRef.Divisor</Tag>
                            }
                            <KubectlExplainButton Field="pod.spec.volumes.downwardAPI.items"></KubectlExplainButton>
                        </HTd>
                    </HTr>
                }
            }


            @if (p.ConfigMap != null)
            {
                @if (p.ConfigMap.Items != null)
                {
                    @foreach (var ktp in p.ConfigMap.Items)
                    {
                        <HTr>
                            <HTd >
                                ConfigMap
                                <KubectlExplainButton Field="pod.spec.volumes.configMap"></KubectlExplainButton>

                            </HTd >
                            <HTd >
                                <Tag Icon="hdd" PresetColor="@PresetColor.Orange">ConfigMap @p.ConfigMap.Name</Tag>
                                <Tag>@ktp.Key => @ktp.Path</Tag>
                                <KubectlExplainButton Field="pod.spec.volumes.configMap.items"></KubectlExplainButton>
                            </HTd>
                        </HTr>
                    }
                }
            }
        }


    </HTable>
}


@code {

    [Parameter]
    public V1Volume Volume { get; set; }

    [Parameter]
    public int Index { get; set; }

}
