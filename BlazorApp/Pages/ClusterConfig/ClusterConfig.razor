@page "/Cluster"
@using k8s.Models
@using Mapster
@using BlazorApp.Pages.Common.Html.HTable
@using BlazorApp.Pages.Node
@using BlazorApp.Pages.Common.Html
@using BlazorApp.Pages.Common

<Card Title="@KubeService.CurrentContext()" Style="width: 400px;margin: 50px">
    @if (ComponentStatus is { Count: > 0 })
    {
        <HTable>
            @foreach (var status in ComponentStatus)
            {
                <HTableColumn Title="@status.Name()">
                    <ConditionsTagView Conditions="@(status.Conditions.Adapt<IList<V1Condition>>())"></ConditionsTagView>
                </HTableColumn>
            }
        </HTable>
    }
</Card>

<Tabs Style="margin: 50px" DefaultActiveKey="1" Type="@TabType.Card" Size="@TabSize.Large">
    <TabPane Key="1" Tab="API Status">
        @if (ApiServicesList is { Count: > 0 })
        {
            <GridRow Class="grid-table">
                <GridCol Span="8">Name</GridCol>
                <GridCol Span="8">Status</GridCol>
            </GridRow>
            @foreach (var item in ApiServicesList)
            {
                <GridRow Class="grid-table grid-table-first-row">
                    <GridCol Span="8"> @item.Name()</GridCol>
                    <GridCol Span="8">
                        <ConditionsTagView Conditions="@(item.Status.Conditions.Adapt<IList<V1Condition>>())"></ConditionsTagView>
                    </GridCol>
                </GridRow>
            }
        }
    </TabPane>
    <TabPane Key="2" Tab="Nodes">
        @if (NodeList is { Count: > 0 })
        {
            <GridRow Class="grid-table">
                <GridCol Span="24">
                    @foreach (var item in NodeList)
                    {
                        <Card Title="@item.Name()" Style="margin: 10px;width: 380px">
                            <NodeStatusChart Node="@item"></NodeStatusChart>
                        </Card>
                    }
                </GridCol>
            </GridRow>
        }
    </TabPane>
    <TabPane Key="3" Tab="Pods">
        @if (PodList is { Count: > 0 })
        {
            <GridRow Class="grid-table">
                <GridCol Span="8">Name</GridCol>
                <GridCol Span="8">CPU</GridCol>
                <GridCol Span="8">Memory</GridCol>
            </GridRow>
            @foreach (var item in PodList)
            {
                <GridRow Class="grid-table grid-table-first-row">
                    <GridCol Span="8">@item.Name()</GridCol>
                    <GridCol Span="8">
                        <MetricView ResourceType="Pod" ItemName="@item.Name()" MetricType="cpu"></MetricView>
                    </GridCol>
                    <GridCol Span="8">
                        <MetricView ResourceType="Pod" ItemName="@item.Name()" MetricType="memory"></MetricView>
                    </GridCol>
                </GridRow>
            }
        }
    </TabPane>
</Tabs>
